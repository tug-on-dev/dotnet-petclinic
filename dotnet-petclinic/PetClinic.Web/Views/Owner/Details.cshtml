@model PetClinic.Web.Models.Owner

@{
    ViewData["Title"] = "Owner Information";
}

<div class="row">
    <div class="col-md-12">
        <h2>Owner Information</h2>
        
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["SuccessMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        
        <div class="card mt-3">
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Name</dt>
                    <dd class="col-sm-9">@Model.FirstName @Model.LastName</dd>
                    
                    <dt class="col-sm-3">Address</dt>
                    <dd class="col-sm-9">@Model.Address</dd>
                    
                    <dt class="col-sm-3">City</dt>
                    <dd class="col-sm-9">@Model.City</dd>
                    
                    <dt class="col-sm-3">Telephone</dt>
                    <dd class="col-sm-9">@Model.Telephone</dd>
                </dl>
                
                <div class="mt-3">
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Edit Owner</a>
                    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
                </div>
            </div>
        </div>
        
        <h3 class="mt-4">Pets and Visits</h3>
        
        @if (Model.Pets.Count == 0)
        {
            <div class="alert alert-info">
                No pets registered for this owner.
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover mt-3">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Birth Date</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var pet in Model.Pets.OrderBy(p => p.Name))
                        {
                            <tr>
                                <td>@pet.Name</td>
                                <td>@pet.BirthDate.ToString("yyyy-MM-dd")</td>
                                <td>@pet.PetType.Name</td>
                                <td>
                                    <a href="/owners/@Model.Id/pets/@pet.Id/edit" class="btn btn-sm btn-primary">Edit Pet</a>
                                    <a href="/owners/@Model.Id/pets/@pet.Id/visits/new" class="btn btn-sm btn-success">Add Visit</a>
                                </td>
                            </tr>
                            @if (pet.Visits.Count > 0)
                            {
                                <tr>
                                    <td colspan="4">
                                        <div class="ms-4">
                                            <h6 class="text-muted">Visits:</h6>
                                            <table class="table table-sm table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Visit Date</th>
                                                        <th>Description</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var visit in pet.Visits.OrderByDescending(v => v.VisitDate))
                                                    {
                                                        <tr>
                                                            <td>@visit.VisitDate.ToString("yyyy-MM-dd")</td>
                                                            <td>@visit.Description</td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        }
        
        <div class="mt-3">
            <a href="/owners/@Model.Id/pets/new" class="btn btn-success">Add New Pet</a>
        </div>
    </div>
</div>
